<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--    ĐƠN THUỐC-->
    <template id="report_sh_medical_patient_prescription_document">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang':o.patient.partner_id.lang})"/>
            <div class="page" style="font-family:Times New Roman;font-size: 16pt;">
                <div class="oe_structure"/>
                <div>
                    <div class="m-0" t-field="o.institution.company_name" style="text-transform: uppercase;font-weight:bold;"/>
                    <div class="m-0">
                        <i><span t-field="o.institution.street"/>,<span t-field="o.institution.street2"/>,
                            <span t-field="o.institution.city"/>
                        </i>
                        <br/>
                        <i>Điện thoại:
                            <span t-field="o.institution.mobile"/>
                        </i>
                    </div>
                </div>
                <h2 class="text-center mt16 mb16">
                    <div style="">
                        <b>ĐƠN THUỐC</b>
                    </div>
                </h2>

                <div t-if="o.patient" class="bm-2">
                    <span>Họ tên:</span>
                    <b style="text-transform: uppercase;" class="m-0 mr-5" t-field="o.patient.name"/>
                    <span>Tuổi:</span>
                    <b class="m-0 mr-5" t-field="o.patient.age"/>
                    <b class="m-0" t-field="o.patient.gender"/>
                </div>
                <div t-if="o.patient" class="bm-2">
                    <span>Địa chỉ:</span>
                    <span class="m-0" t-field="o.patient.street"/>,
                    <span class="m-0" t-field="o.patient.district_id.name"/>,
                    <span class="m-0" t-field="o.patient.state_id.name"/>
                </div>
<!--                <div t-if="o.walkin" class="bm-2">-->
<!--                    <span>Booking:</span>-->
<!--                    <t t-if="o.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-elif="o.evaluation and o.evaluation.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.evaluation.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-else=""/>-->
<!--                </div>-->
                <!--                <div t-if="o.services" class="bm-2">-->
                <!--                    <span>Chẩn đoán:</span>-->
                <!--                    <i><strong class="m-0" t-esc="'; '.join(map(str, o.services.mapped('name')))"/></i>-->
                <!--                </div>-->
                <div t-if="o.services" class="bm-2">
                    <span>Chẩn đoán:</span>
                    <!--                    <t t-if="o.walkin.pathology">-->
                    <!--                        <i>-->
                    <!--                            <strong t-field="o.walkin.pathology.code"/>-->
                    <!--                            - -->
                    <!--                            <strong t-field="o.walkin.pathology.name"/>-->
                    <!--                        </i>-->
                    <!--                    </t>-->
                    <!--                    <t t-else="">-->
                    <!--                        <i><strong class="m-0" t-esc="'; '.join(map(str, o.services.mapped('name')))"/></i>-->
                    <!--                    </t>-->
                    <!--                    <t t-if="o.institution.brand.code in ['DA', 'KN']">-->
                    <!--                        <t t-set="technical_name" t-value="o.services.mapped('technical_name')"/>-->
                    <!--                        <t t-if="(len(set(o.services.mapped('technical_name'))) == 1) and (False in set(o.services.mapped('technical_name')))">-->
                    <!--                            <span>.................................................................................................................</span>-->
                    <!--                        </t>-->
                    <!--                        <t t-else="">-->
                    <!--                            <t t-foreach="technical_name" t-as="name">-->
                    <!--                                <t t-if="name">-->
                    <!--                                    <i><strong><t t-esc="name"/>,</strong></i>-->
                    <!--                                </t>-->
                    <!--                            </t>-->
                    <!--                        </t>-->
                    <!--                    </t>-->
                    <!--                    <t t-else="">-->
                    <!--                        <i><strong class="m-0" t-esc="'; '.join(map(str, o.services.mapped('name')))"/></i>-->
                    <!--                    </t>-->
                    <t t-if="(o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <i>
                            <strong t-field="o.diagnose"/>
                        </i>
                    </t>
                    <t t-elif="(not o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <t t-set="technical_name" t-value="o.services.mapped('technical_name')"/>
                        <t t-if="(len(set(o.services.mapped('technical_name'))) == 1) and (False in set(o.services.mapped('technical_name')))">
                            <span>
                                .................................................................................................................
                            </span>
                        </t>
                        <t t-else="">
                            <t t-foreach="technical_name" t-as="name">
                                <t t-if="name">
                                    <i>
                                        <strong><t t-esc="name"/>,
                                        </strong>
                                    </i>
                                </t>
                            </t>
                        </t>
                    </t>
                    <t t-else="">
                        <span>
                            .................................................................................................................
                        </span>
                    </t>
                </div>
                <!--                <div t-if="o.room_request" class="bm-2">-->
                <!--                    <span>Phòng yêu cầu:</span>-->
                <!--                    <i><strong class="m-0" t-field="o.room_request.name"/></i>-->
                <!--                </div>-->
                <!--                <div t-if="o.room_stock_out" class="bm-2">-->
                <!--                    <span>Phòng xuất đơn:</span>-->
                <!--                    <i><strong class="m-0" t-field="o.room_stock_out.name"/></i>-->
                <!--                </div>-->

                <table class="table mt-3">
                    <tr>
                        <td colspan="2" class="m-0 p-0" style="border: none;">Thuốc điều trị</td>
                    </tr>
                    <t t-set="i" t-value="0"/>
                    <t t-foreach="o.prescription_line" t-as="l">
                        <t t-set="i" t-value="i + 1"/>
                        <tr>
                            <td class="m-0 p-0" style="font-weight:bold;width:70%;border: none;"><t t-esc="i"/>.
                                <t t-if="l.medicament_type == 'Medicine'">
                                    <span t-field="l.name.composition"/>
                                    <t t-if="l.name.name_medicine">
                                        (<span t-field="l.name.name_medicine"/>)
                                    </t>
                                    <t t-else="">
                                    </t>
                                    <t t-if="l.name.concentration">
                                        <span t-field="l.name.concentration"/>
                                    </t>
                                    <t t-else="">
                                    </t>
                                </t>
                                <t t-else="">
                                    <span t-field="l.name.name_use"/>
                                </t>

                            </td>
                            <td class="m-0 p-0" style="font-weight:bold;border: none;">x
                                <span t-esc="int(l.qty)"/>
                                <span t-field="l.dose_unit_related"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="m-0 p-0" colspan="2" style="border: none;">
                                <i class="ml-3" t-field="l.info"/>
                            </td>
                        </tr>
                    </t>
                </table>

                <div class="my-2 py-3">
                    <em>Lời dặn: Thay băng, cắt chỉ, tái khám theo lịch hẹn</em>
                </div>

                <div class="row my-2" style="page-break-inside:avoid;">
                    <div class="col-6 bm-2 text-left">
                        <div style="height:40px;"/>
                        <div class="m-0">Bệnh nhân ký nhận</div>
                        <div style="height:80px;"/>
                        <span class="m-0" t-field="o.patient.name"/>
                    </div>
                    <div class="col-6 bm-2 text-center">
                        <div class="m-0" t-esc="context_timestamp(o.date_out).strftime('Ngày %d tháng %m năm %Y')"/>
                        <div class="m-0">Bác sĩ khám bệnh</div>
                        <div style="height:80px;"/>
                        <t t-if="o.doctor.degree_id">
                            <span class="m-0" t-esc="', '.join(map(str, o.doctor.degree_id.mapped('name')))"/>
                        </t>
                        <span class="m-0" t-field="o.doctor.name"/>
                    </div>
                </div>
                <div class="my-2">
                    <em>Khám lại xin mang theo đơn này</em>
                </div>
                <div class="oe_structure"/>

                <!--            <t t-if="o.info">-->
                <!--                <p style="page-break-before:always;"> </p>-->
                <!--                <div>-->
                <!--                    <div t-raw="o.info"/>-->
                <!--                </div>-->
                <!--            </t>-->
            </div>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescription">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="shealth_all_in_one.report_sh_medical_patient_prescription_document"
                   t-lang="o.patient.partner_id.lang"/>
            </t>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescription_document_11">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang':o.patient.partner_id.lang})"/>
            <div class="page" style="font-family:Times New Roman;font-size: 14pt;">
                <div class="oe_structure"/>
                <div>
                    <div class="m-0" t-field="o.institution.company_name" style="text-transform: uppercase;font-weight:bold;"/>
                    <div class="m-0">
                        <i><span t-field="o.institution.street"/>,<span t-field="o.institution.street2"/>,
                            <span t-field="o.institution.city"/>
                        </i>
                        <br/>
                        <i>Điện thoại:
                            <span t-field="o.institution.mobile"/>
                        </i>
                    </div>
                </div>
                <h2 class="text-center mt16 mb16">
                    <div style="">
                        <b>ĐƠN THUỐC</b>
                    </div>
                </h2>

                <div t-if="o.patient" class="bm-2">
                    <span>Họ tên:</span>
                    <b style="text-transform: uppercase;" class="m-0 mr-5" t-field="o.patient.name"/>
                    <span>Tuổi:</span>
                    <b class="m-0 mr-5" t-field="o.patient.age"/>
                    <b class="m-0" t-field="o.patient.gender"/>
                </div>
                <div t-if="o.patient" class="bm-2">
                    <span>Địa chỉ:</span>
                    <span class="m-0" t-field="o.patient.street"/>,
                    <span class="m-0" t-field="o.patient.district_id.name"/>,
                    <span class="m-0" t-field="o.patient.state_id.name"/>
                </div>
<!--                <div t-if="o.walkin" class="bm-2">-->
<!--                    <span>Booking:</span>-->
<!--                    <t t-if="o.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-elif="o.evaluation and o.evaluation.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.evaluation.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-else=""/>-->
<!--                </div>-->
                <!--                <div t-if="o.services" class="bm-2">-->
                <!--                    <span>Chẩn đoán:</span>-->
                <!--                    <i><strong class="m-0" t-esc="'; '.join(map(str, o.services.mapped('name')))"/></i>-->
                <!--                </div>-->
                <div t-if="o.services" class="bm-2">
                    <span>Chẩn đoán:</span>
                    <t t-if="(o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <i>
                            <strong t-field="o.diagnose"/>
                        </i>
                    </t>
                    <t t-elif="(not o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <t t-set="technical_name" t-value="o.services.mapped('technical_name')"/>
                        <t t-if="(len(set(o.services.mapped('technical_name'))) == 1) and (False in set(o.services.mapped('technical_name')))">
                            <span>
                                .................................................................................................................
                            </span>
                        </t>
                        <t t-else="">
                            <t t-foreach="technical_name" t-as="name">
                                <t t-if="name">
                                    <i>
                                        <strong><t t-esc="name"/>,
                                        </strong>
                                    </i>
                                </t>
                            </t>
                        </t>
                    </t>
                    <t t-else="">
                        <span>
                            .................................................................................................................
                        </span>
                    </t>
                </div>

                <table class="table mt-3">
                    <tr>
                        <td colspan="2" class="m-0 p-0" style="border: none;">Thuốc điều trị</td>
                    </tr>
                    <t t-set="i" t-value="0"/>
                    <t t-foreach="o.prescription_line" t-as="l">
                        <t t-set="i" t-value="i + 1"/>
                        <tr>
                            <td class="m-0 p-0" style="font-weight:bold;width:70%;border: none;"><t t-esc="i"/>.
                                <t t-if="l.medicament_type == 'Medicine'">
                                    <span t-field="l.name.composition"/>
                                    <t t-if="l.name.name_medicine">
                                        (<span t-field="l.name.name_medicine"/>)
                                    </t>
                                    <t t-else="">
                                    </t>
                                    <t t-if="l.name.concentration">
                                        <span t-field="l.name.concentration"/>
                                    </t>
                                    <t t-else="">
                                    </t>
                                </t>
                                <t t-else="">
                                    <span t-field="l.name.name_use"/>
                                </t>
                            </td>
                            <td class="m-0 p-0" style="font-weight:bold;border: none;">x
                                <span t-esc="int(l.qty)"/>
                                <span t-field="l.dose_unit_related"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="m-0 p-0" colspan="2" style="border: none;">
                                <i class="ml-3" t-field="l.info"/>
                            </td>
                        </tr>
                    </t>
                </table>

                <div class="my-2 py-3">
                    <em>Lời dặn: Thay băng, cắt chỉ, tái khám theo lịch hẹn</em>
                </div>

                <div class="row my-2" style="page-break-inside:avoid;">
                    <div class="col-6 bm-2 text-left">
                        <div style="height:20px;"/>
                        <div class="m-0">Bệnh nhân ký nhận</div>
                        <div style="height:50px;"/>
                        <span class="m-0" t-field="o.patient.name"/>
                    </div>
                    <div class="col-6 bm-2 text-center">
                        <div class="m-0" t-esc="context_timestamp(o.date_out).strftime('Ngày %d tháng %m năm %Y')"/>
                        <div class="m-0">Bác sĩ khám bệnh</div>
                        <div style="height:50px;"/>
                        <t t-if="o.doctor.degree_id">
                            <span class="m-0" t-esc="', '.join(map(str, o.doctor.degree_id.mapped('name')))"/>
                        </t>
                        <span class="m-0" t-field="o.doctor.name"/>
                    </div>
                </div>
                <div class="my-2">
                    <em>Khám lại xin mang theo đơn này</em>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescriptions_11">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="shealth_all_in_one.report_sh_medical_patient_prescription_document_11"
                   t-lang="o.patient.partner_id.lang"/>
            </t>
        </t>
    </template>

    <!--    ĐƠN THUỐC KHÔNG VẬT TƯ-->

    <template id="report_sh_medical_patient_prescription_document_no_supply">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang':o.patient.partner_id.lang})"/>
            <div class="page" style="font-family:Times New Roman;font-size: 16pt;">
                <div class="oe_structure"/>
                <div>
                    <div class="m-0" t-field="o.institution.company_name" style="text-transform: uppercase;font-weight:bold;"/>
                    <div class="m-0">
                        <i><span t-field="o.institution.street"/>,<span t-field="o.institution.street2"/>,
                            <span t-field="o.institution.city"/>
                        </i>
                        <br/>
                        <i>Điện thoại:
                            <span t-field="o.institution.mobile"/>
                        </i>
                    </div>
                </div>
                <h2 class="text-center mt16 mb16">
                    <div style="">
                        <b>ĐƠN THUỐC</b>
                    </div>
                </h2>

                <div t-if="o.patient" class="bm-2">
                    <span>Họ tên:</span>
                    <b style="text-transform: uppercase;" class="m-0 mr-5" t-field="o.patient.name"/>
                    <span>Tuổi:</span>
                    <b class="m-0 mr-5" t-field="o.patient.age"/>
                    <b class="m-0" t-field="o.patient.gender"/>
                </div>
                <div t-if="o.patient" class="bm-2">
                    <span>Địa chỉ:</span>
                    <span class="m-0" t-field="o.patient.street"/>,
                    <span class="m-0" t-field="o.patient.district_id.name"/>,
                    <span class="m-0" t-field="o.patient.state_id.name"/>
                </div>
<!--                <div t-if="o.walkin" class="bm-2">-->
<!--                    <span>Booking:</span>-->
<!--                    <t t-if="o.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-elif="o.evaluation and o.evaluation.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.evaluation.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-else=""/>-->
<!--                </div>-->
                <div t-if="o.services" class="bm-2">
                    <span>Chẩn đoán:</span>
                    <t t-if="(o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <i>
                            <strong t-field="o.diagnose"/>
                        </i>
                    </t>
                    <t t-elif="(not o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <t t-set="technical_name" t-value="o.services.mapped('technical_name')"/>
                        <t t-if="(len(set(o.services.mapped('technical_name'))) == 1) and (False in set(o.services.mapped('technical_name')))">
                            <span>
                                .................................................................................................................
                            </span>
                        </t>
                        <t t-else="">
                            <t t-foreach="technical_name" t-as="name">
                                <t t-if="name">
                                    <i>
                                        <strong><t t-esc="name"/>,
                                        </strong>
                                    </i>
                                </t>
                            </t>
                        </t>
                    </t>
                    <t t-else="">
                        <span>
                            .................................................................................................................
                        </span>
                    </t>
                </div>

                <table class="table mt-3">
                    <tr>
                        <td colspan="2" class="m-0 p-0" style="border: none;">Thuốc điều trị</td>
                    </tr>
                    <t t-set="i" t-value="0"/>
                    <t t-foreach="o.prescription_line" t-as="l">
                        <t t-if="l.medicament_type == 'Medicine'">
                            <t t-set="i" t-value="i + 1"/>
                            <tr>
                                <td class="m-0 p-0" style="font-weight:bold;width:70%;border: none;"><t t-esc="i"/>.
                                    <t t-if="l.medicament_type == 'Medicine'">
                                        <span t-field="l.name.composition"/>
                                        <t t-if="l.name.name_medicine">
                                            (<span t-field="l.name.name_medicine"/>)
                                        </t>
                                        <t t-else="">
                                        </t>
                                        <t t-if="l.name.concentration">
                                            <span t-field="l.name.concentration"/>
                                        </t>
                                        <t t-else="">
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <span t-field="l.name.name_use"/>
                                    </t>

                                </td>
                                <td class="m-0 p-0" style="font-weight:bold;border: none;">x
                                    <span t-esc="int(l.qty)"/>
                                    <span t-field="l.dose_unit_related"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="m-0 p-0" colspan="2" style="border: none;">
                                    <i class="ml-3" t-field="l.info"/>
                                </td>
                            </tr>
                        </t>
                        <t t-else=""/>
                    </t>
                </table>

                <div class="my-2 py-3">
                    <em>Lời dặn: Thay băng, cắt chỉ, tái khám theo lịch hẹn</em>
                </div>

                <div class="row my-2" style="page-break-inside:avoid;">
                    <div class="col-6 bm-2 text-left">
                        <div style="height:40px;"/>
                        <div class="m-0">Bệnh nhân ký nhận</div>
                        <div style="height:80px;"/>
                        <span class="m-0" t-field="o.patient.name"/>
                    </div>
                    <div class="col-6 bm-2 text-center">
                        <div class="m-0" t-esc="context_timestamp(o.date_out).strftime('Ngày %d tháng %m năm %Y')"/>
                        <div class="m-0">Bác sĩ khám bệnh</div>
                        <div style="height:80px;"/>
                        <t t-if="o.doctor.degree_id">
                            <span class="m-0" t-esc="', '.join(map(str, o.doctor.degree_id.mapped('name')))"/>
                        </t>
                        <span class="m-0" t-field="o.doctor.name"/>
                    </div>
                </div>
                <div class="my-2">
                    <em>Khám lại xin mang theo đơn này</em>
                </div>
                <div class="oe_structure"/>

                <!--            <t t-if="o.info">-->
                <!--                <p style="page-break-before:always;"> </p>-->
                <!--                <div>-->
                <!--                    <div t-raw="o.info"/>-->
                <!--                </div>-->
                <!--            </t>-->
            </div>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescription_no_supply">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="shealth_all_in_one.report_sh_medical_patient_prescription_document_no_supply"
                   t-lang="o.patient.partner_id.lang"/>
            </t>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescription_document_11_no_supply">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang':o.patient.partner_id.lang})"/>
            <div class="page" style="font-family:Times New Roman;font-size: 14pt;">
                <div class="oe_structure"/>
                <div>
                    <div class="m-0" t-field="o.institution.company_name" style="text-transform: uppercase;font-weight:bold;"/>
                    <div class="m-0">
                        <i><span t-field="o.institution.street"/>,<span t-field="o.institution.street2"/>,
                            <span t-field="o.institution.city"/>
                        </i>
                        <br/>
                        <i>Điện thoại:
                            <span t-field="o.institution.mobile"/>
                        </i>
                    </div>
                </div>
                <h2 class="text-center mt16 mb16">
                    <div style="">
                        <b>ĐƠN THUỐC</b>
                    </div>
                </h2>

                <div t-if="o.patient" class="bm-2">
                    <span>Họ tên:</span>
                    <b style="text-transform: uppercase;" class="m-0 mr-5" t-field="o.patient.name"/>
                    <span>Tuổi:</span>
                    <b class="m-0 mr-5" t-field="o.patient.age"/>
                    <b class="m-0" t-field="o.patient.gender"/>
                </div>
                <div t-if="o.patient" class="bm-2">
                    <span>Địa chỉ:</span>
                    <span class="m-0" t-field="o.patient.street"/>,
                    <span class="m-0" t-field="o.patient.district_id.name"/>,
                    <span class="m-0" t-field="o.patient.state_id.name"/>
                </div>
<!--                <div t-if="o.walkin" class="bm-2">-->
<!--                    <span>Booking:</span>-->
<!--                    <t t-if="o.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-elif="o.evaluation and o.evaluation.walkin">-->
<!--                        <strong><span class="m-0" t-esc="o.evaluation.walkin.booking_id.name"/></strong>-->
<!--                    </t>-->
<!--                    <t t-else=""/>-->
<!--                </div>-->
                <div t-if="o.services" class="bm-2">
                    <span>Chẩn đoán:</span>
                    <t t-if="(o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <i>
                            <strong t-field="o.diagnose"/>
                        </i>
                    </t>
                    <t t-elif="(not o.diagnose) and (o.institution.brand.code in ['DA', 'KN'])">
                        <t t-set="technical_name" t-value="o.services.mapped('technical_name')"/>
                        <t t-if="(len(set(o.services.mapped('technical_name'))) == 1) and (False in set(o.services.mapped('technical_name')))">
                            <span>
                                .................................................................................................................
                            </span>
                        </t>
                        <t t-else="">
                            <t t-foreach="technical_name" t-as="name">
                                <t t-if="name">
                                    <i>
                                        <strong><t t-esc="name"/>,
                                        </strong>
                                    </i>
                                </t>
                            </t>
                        </t>
                    </t>
                    <t t-else="">
                        <span>
                            .................................................................................................................
                        </span>
                    </t>
                </div>

                <table class="table mt-3">
                    <tr>
                        <td colspan="2" class="m-0 p-0" style="border: none;">Thuốc điều trị</td>
                    </tr>
                    <t t-set="i" t-value="0"/>
                    <t t-foreach="o.prescription_line" t-as="l">
                        <t t-if="l.medicament_type == 'Medicine'">
                            <t t-set="i" t-value="i + 1"/>
                            <tr>
                                <td class="m-0 p-0" style="font-weight:bold;width:70%;border: none;"><t t-esc="i"/>.
                                    <t t-if="l.medicament_type == 'Medicine'">
                                        <span t-field="l.name.composition"/>
                                        <t t-if="l.name.name_medicine">
                                            (<span t-field="l.name.name_medicine"/>)
                                        </t>
                                        <t t-else="">
                                        </t>
                                        <t t-if="l.name.concentration">
                                            <span t-field="l.name.concentration"/>
                                        </t>
                                        <t t-else="">
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <span t-field="l.name.name_use"/>
                                    </t>
                                </td>
                                <td class="m-0 p-0" style="font-weight:bold;border: none;">x
                                    <span t-esc="int(l.qty)"/>
                                    <span t-field="l.dose_unit_related"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="m-0 p-0" colspan="2" style="border: none;">
                                    <i class="ml-3" t-field="l.info"/>
                                </td>
                            </tr>
                        </t>
                        <t t-else=""/>
                    </t>
                </table>

                <div class="my-2 py-3">
                    <em>Lời dặn: Thay băng, cắt chỉ, tái khám theo lịch hẹn</em>
                </div>

                <div class="row my-2" style="page-break-inside:avoid;">
                    <div class="col-6 bm-2 text-left">
                        <div style="height:20px;"/>
                        <div class="m-0">Bệnh nhân ký nhận</div>
                        <div style="height:50px;"/>
                        <span class="m-0" t-field="o.patient.name"/>
                    </div>
                    <div class="col-6 bm-2 text-center">
                        <div class="m-0" t-esc="context_timestamp(o.date_out).strftime('Ngày %d tháng %m năm %Y')"/>
                        <div class="m-0">Bác sĩ khám bệnh</div>
                        <div style="height:50px;"/>
                        <t t-if="o.doctor.degree_id">
                            <span class="m-0" t-esc="', '.join(map(str, o.doctor.degree_id.mapped('name')))"/>
                        </t>
                        <span class="m-0" t-field="o.doctor.name"/>
                    </div>
                </div>
                <div class="my-2">
                    <em>Khám lại xin mang theo đơn này</em>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

    <template id="report_sh_medical_patient_prescriptions_11_no_supply">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="shealth_all_in_one.report_sh_medical_patient_prescription_document_11_no_supply"
                   t-lang="o.patient.partner_id.lang"/>
            </t>
        </t>
    </template>

    <!--    HƯỚNG DẪN CHĂM SÓC -->
    <template id="report_sh_medical_patient_reexam_huongdan_document">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context({'lang':o.patient.partner_id.lang})"/>
            <div class="page" style="font-family:Times New Roman;font-size: 24px;">
                <div class="oe_structure"/>
                <t t-if="o.walkin.room_type != 'Surgery'">
                    <div>
                        <div class="m-0" t-field="o.walkin.institution.name"
                             style="text-transform: uppercase;font-size: 26px;font-weight:bold;"/>
                        <div class="m-0" style="font-size: 23px;">
                            <i><span t-field="o.walkin.institution.street"/>,<span
                                    t-field="o.walkin.institution.street2"/>,
                                <span t-field="o.walkin.institution.city"/>
                            </i>
                            <br/>
                            <i>Điện thoại:
                                <span t-field="o.walkin.institution.phone"/>
                            </i>
                        </div>
                    </div>
                    <h2 class="text-center mt16 mb16">
                        <div style="">
                            <b>HƯỚNG DẪN CHĂM SÓC TẠI NHÀ</b>
                        </div>
                    </h2>

                    <div t-if="o.patient" class="bm-2">
                        <span>Họ tên:</span>
                        <b style="text-transform: uppercase;" class="m-0 mr-5" t-field="o.patient.name"/>
                        <span>Tuổi:</span>
                        <b class="m-0 mr-5" t-field="o.patient.age"/>
                        <b class="m-0" t-field="o.patient.gender"/>
                    </div>
                    <div t-if="o.patient" class="bm-2">
                        <span>Địa chỉ:</span>
                        <span class="m-0" t-field="o.patient.street"/>,
                        <span class="m-0" t-field="o.patient.state_id.name"/>
                    </div>
                    <div t-if="o.services" class="bm-2">
                        <span>Chẩn đoán:</span>
                        <i>
                            <strong class="m-0" t-esc="'; '.join(map(str, o.services.mapped('name')))"/>
                        </i>
                    </div>
                    <div style="font-style:italic;font-size:22px" class="p-3">
                        <div><![CDATA[&emsp;]]> Cám ơn Quý khách đã tin tưởng sử dụng dịch vụ tại
                            <span t-field="o.walkin.institution.name"/>
                        </div>
                        <div><![CDATA[&emsp;]]> Quý Khách vui lòng tuân thủ theo lịch hẹn của Bác Sĩ, đọc kỹ hướng dẫn
                            sử dụng sau khi làm dịch vụ và thực hiện đúng theo để đạt hiệu quả tốt nhất.
                        </div>
                    </div>
                </t>
                <t t-else="">
                    <h2 class="text-center mt16 mb16">
                        <div style="font-weight:bold;text-transform:uppercase;">HƯỚNG DẪN SAU
                            <span t-esc="';'.join(map(str, o.services.mapped('name')))"/>
                        </div>
                    </h2>
                </t>

                <t t-set="service_date" t-value="o.date"/>
                <div>
                    <div class="m-0 p-0" style="border: none;">1. Ngày
                        <t t-if="o.walkin.room_type == 'Surgery'">phẫu thuật</t>
                        <t t-else="">làm dịch vụ</t>:
                        <b t-esc="(service_date + relativedelta(hours=7)).strftime('%d/%m/%Y')"/>
                    </div>
                </div>

                <div>
                    <div class="m-0 p-0" style="border: none;">
                        <t t-set="i" t-value="1"/>
                        <t t-foreach="o.days_reexam.filtered(lambda d: (d.type not in ['ReCheck7']) and (d.is_print == True)).sorted(key=lambda a:(a.date_recheck_print))"
                           t-as="l">
                            <t t-set="i" t-value="i + 1"/>
                            <!--                        <div style="width:45%;display:inline-block;">-->
                            <div>
                                <t t-esc="i"/>.<span t-field="l.name"/>:
                                <b t-field="l.date_recheck_print"/>
                            </div>
                        </t>
                    </div>
                </div>
                <t t-set="days_reexam_dk"
                   t-value="o.days_reexam.filtered(lambda d: (d.type in ['ReCheck7']) and (d.is_print == True)).sorted(key=lambda a:(a.date_recheck_print))"/>
                <div t-if="days_reexam_dk">
                    <div class="m-0 p-0" style="border: none;">
                        <t t-set="i" t-value="i + 1"/>
                        <t t-esc="i"/>. Tái khám:
                        <br/>
                        <t t-set="j" t-value="0"/>
                        <t t-foreach="days_reexam_dk" t-as="dr">
                            <t t-set="j" t-value="j + 1"/>
                            <t t-set="duration_year" t-value="int(dr.after_service_date/365)"/>
                            <t t-if="duration_year == 0">
                                <t t-set="duration_month" t-value="int(dr.after_service_date/30)"/>
                                <t t-if="duration_month == 0">
                                    <t t-set="duration_day" t-value="dr.after_service_date"/>
                                    <![CDATA[&emsp;&emsp;]]>Sau
                                    <span t-esc="str(duration_day) + ' ngày'"/>
                                    <b>(<i t-field="dr.date_recheck_print"/>)
                                    </b>
                                    đến kiểm tra lại lần
                                    <t t-esc="j"/>
                                    <br/>
                                </t>
                                <t t-else="">
                                    <![CDATA[&emsp;&emsp;]]>Sau
                                    <span t-esc="str(duration_month) + ' tháng'"/>
                                    <b>(<i t-field="dr.date_recheck_print"/>)
                                    </b>
                                    đến kiểm tra lại lần
                                    <t t-esc="j"/>
                                    <br/>
                                </t>
                            </t>
                            <t t-else="">
                                <![CDATA[&emsp;&emsp;]]>Sau
                                <span t-esc="str(duration_year) + ' năm'"/>
                                <b>(<i t-field="dr.date_recheck_print"/>)
                                </b>
                                đến kiểm tra lại lần
                                <t t-esc="j"/>
                                <br/>
                            </t>
                        </t>
                    </div>
                </div>
                <div t-if="o.info">
                    <div class="m-0 p-0" style="border: none;">
                        <br/>
                        <t t-set="i" t-value="i + 1"/>
                        <t t-esc="i"/>. Chăm sóc:
                        <br/>
                        <t t-set="data_infor" t-value="o.info.replace('\n','&lt;br/&gt;')"/>
                        <div widget="html" t-raw="data_infor"/>
                    </div>
                </div>
                <!--            <table class="table mt-5">-->
                <!--                <tr>-->
                <!--                    <td class="m-0 p-0" style="border: none;">1. Ngày phẫu thuật: <b t-esc="service_date.strftime('%d/%m/%Y')"/></td>-->
                <!--                </tr>-->

                <!--                <tr>-->
                <!--                    <td class="m-0 p-0" style="border: none;">-->
                <!--                        <t t-set="i" t-value="1" />-->
                <!--                        <t t-foreach="o.days_reexam.filtered(lambda d: (d.type not in ['ReCheck7']) and (d.is_print == True))" t-as="l">-->
                <!--                            <t t-set="i" t-value="i + 1" />-->
                <!--                            <div style="width:45%;display:inline-block;">-->
                <!--                                <t t-esc="i"/>. <span t-field="l.name"/>: <b t-field="l.date_recheck_print"/>-->
                <!--                            </div>-->
                <!--                        </t>-->
                <!--                    </td>-->
                <!--                </tr>-->
                <!--                <t t-set="days_reexam_dk" t-value="o.days_reexam.filtered(lambda d: (d.type in ['ReCheck7']) and (d.is_print == True))"/>-->
                <!--                <tr t-if="days_reexam_dk">-->
                <!--                    <td class="m-0 p-0" style="border: none;">-->
                <!--                        <t t-set="i" t-value="i + 1" />-->
                <!--                        <t t-esc="i"/>. Tái khám:<br/>-->
                <!--                        <t t-set="j" t-value="0" />-->
                <!--                        <t t-foreach="days_reexam_dk" t-as="dr">-->
                <!--                            <t t-set="j" t-value="j + 1" />-->
                <!--                            <t t-set="duration_year" t-value="int(dr.after_service_date/365)" />-->
                <!--                            <t t-if="duration_year == 0">-->
                <!--                                <t t-set="duration_month" t-value="int(dr.after_service_date/30)" />-->
                <!--                                <t t-if="duration_month == 0">-->
                <!--                                    <t t-set="duration_day" t-value="dr.after_service_date" />-->
                <!--                                    <![CDATA[&emsp;&emsp;]]>Sau <span t-esc="str(duration_day) + ' ngày'"/> <b>(<i t-field="dr.date_recheck_print"/>)</b> đến kiểm tra lại lần <t t-esc="j"/><br/>-->
                <!--                                </t>-->
                <!--                                <t t-else="">-->
                <!--                                    <![CDATA[&emsp;&emsp;]]>Sau <span t-esc="str(duration_month) + ' tháng'"/> <b>(<i t-field="dr.date_recheck_print"/>)</b> đến kiểm tra lại lần <t t-esc="j"/><br/>-->
                <!--                                </t>-->
                <!--                            </t>-->
                <!--                            <t t-else="">-->
                <!--                                <![CDATA[&emsp;&emsp;]]>Sau <span t-esc="str(duration_year) + ' năm'"/> <b>(<i t-field="dr.date_recheck_print"/>)</b> đến kiểm tra lại lần <t t-esc="j"/><br/>-->
                <!--                            </t>-->
                <!--                        </t>-->
                <!--                    </td>-->
                <!--                </tr>-->
                <!--                <tr t-if="o.info">-->
                <!--                    <td class="m-0 p-0" style="border: none;">-->
                <!--                        <br/>-->
                <!--                        <t t-set="i" t-value="i + 1" />-->
                <!--                        <t t-esc="i"/>. Chăm sóc:<br/>-->
                <!--                        <t t-set="data_infor" t-value="o.info.replace('\n','&lt;br/&gt;')" />-->
                <!--                        <div widget="html" t-raw="data_infor"/>-->
                <!--                    </td>-->
                <!--                </tr>-->
                <!--            </table>-->

                <t t-if="o.walkin.room_type == 'Surgery'">
                    <div class="text-center">
                        <em>Xin Quý khách vui lòng liên hệ hotline để được hỗ trợ và giải đáp thắc mắc<br/>P.CSKH:
                            <b>
                                <span t-field="o.walkin.institution.mobile"/>
                            </b>
                        </em>
                    </div>
                </t>
                <t t-else="">
                    <div class="row">
                        <div class="col-5"/>
                        <div class="col-7 text-center">
                            <div style="font-size:18px;"><i t-field="o.walkin.institution.city"/>,
                                <i t-esc="context_timestamp(o.date_out).strftime('%H:%M Ngày %d tháng %m năm %Y')"/>
                            </div>
                            <strong style="font-size: 22px;">KTV Chăm sóc</strong>
                            <div style="height:80px;"/>
                        </div>
                    </div>

                    <div class="text-center">
                        <em>Cảm ơn Quý khách hàng đã sử dụng dịch vụ của<span t-field="o.walkin.institution.name"/>.
                            <br/>Mọi thắc mắc xin liên hệ:
                            <b>
                                <span t-field="o.walkin.institution.mobile"/>
                            </b>
                            <br/>Website:
                            <b>
                                <span t-field="o.walkin.institution.website"/>
                            </b>
                        </em>
                    </div>
                </t>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>
    <template id="report_sh_medical_patient_reexam_huongdan">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="shealth_all_in_one.report_sh_medical_patient_reexam_huongdan_document"
                   t-lang="o.patient.partner_id.lang"/>
            </t>
        </t>
    </template>
</odoo>
