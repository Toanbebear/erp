<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
         <!-- Tìm kiếm Phiếu khám -->
        <record id="view_phieu_kham_filter" model="ir.ui.view">
            <field name="name">Tìm kiếm phiếu khám</field>
            <field name="model">sh.medical.appointment.register.walkin</field>
            <field name="type">search</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <search string="Tìm phiếu khám">
                    <separator orientation="vertical"/>
                    <field name="patient" string="Bệnh nhân" select="1"/>
                    <field name="booking_id" string="Mã booking" select="1"/>
                    <field name="name" select="1" string="Mã phiếu khám"/>
                    <field name="service" string="Dịch vụ" select="1"/>
                    <field name="doctor" string="Bác sĩ" select="1"/>
                    <field name="state" string="Trạng thái" select="1"/>
                    <field name="note" string="Ghi chú" select="1"/>
                    <newline/>
                    <filter name="date_filter" string="Hôm nay"
                            domain="[('date', '=', context_today().strftime('%Y-%m-%d'))]" />
                    <filter name="last_date_filter" string="Trước đây"
                            domain="[('date', '&lt;', context_today().strftime('%Y-%m-%d'))]" />
                    <filter name="next_date_filter" string="Sắp tới"
                            domain="[('date', '&gt;', context_today().strftime('%Y-%m-%d'))]" />
<!--                    <filter name="last_date_filter" string="Hôm qua"-->
<!--                            domain="[('date', '=', (context_today()-relativedelta(days=1)).strftime('%Y-%m-%d'))]" />-->
<!--                    <filter name="next_date_filter" string="Ngày mai"-->
<!--                            domain="[('date', '=', (context_today()+relativedelta(days=1)).strftime('%Y-%m-%d'))]" />-->
                    <filter string="Phiếu khám của tôi"
                            name="my_walkin"
                            domain="['|', ('doctor', '=', False), ('doctor.sh_user_id', '=', uid)]"/>
                    <newline/>
                    <filter string="Phiếu chờ khám" name="state_scheduled" domain="[('state', '=', 'Scheduled')]"/>
                    <filter string="Phiếu khám đang chờ thanh toán" name="state_waitpayment"
                            domain="[('state', '=', 'WaitPayment')]"/>
                    <filter string="Phiếu khám đang thực hiện dịch" name="state_inprogress"
                            domain="[('state', '=', 'InProgress')]"/>
                    <filter string="Phiếu khám chưa trả kết quả XN" name="stat_not_done_lab"
                            domain="[('has_processing_lab', '=', True)]"/>
                    <filter string="Phiếu khám chưa trả kết quả CĐHA" name="state"
                            domain="[('has_img_result', '=', False)]"/>
<!--                    <filter string="Phiếu khám hoàn thành" name="state_completed" domain="[('state', '=', 'Completed')]"/>-->
                    <newline/>
                    <filter string="Phiếu khám bảo hành" name="crm_type_oppor_guarantee"
                            domain="[('type_crm_id', 'ilike', 'bảo hành')]"/>
                    <newline/>
                    <filter string="Ngày khám" name="date" date="date"/>
                    <newline/>
                    <filter string="Phiếu khám chưa hoàn thành" name="filter_not_completed"
                            domain="[('state','!=','Completed')]"/>
                    <newline/>
                    <filter string="Phiếu đã hoàn thành" name="filter_completed" domain="[('state','=','Completed')]"/>
                    <newline/>
                    <filter string="Phiếu đã thanh toán" name="filter_payment" domain="[('state','=','Payment')]"/>
                    <newline/>
                    <group expand="0" string="Nhóm theo..." colspan="11" col="11">
                        <filter name="group_patient" string="Bệnh nhân" context="{'group_by':'patient'}"/>
                        <filter name="group_booking" string="Booking" context="{'group_by':'booking_id'}"/>
                        <filter name="group_doctor" string="Bác sĩ" context="{'group_by':'doctor'}"/>
                        <filter name="group_sex" string="Giới tính" context="{'group_by':'sex'}"/>
                        <filter name="group_blood_type" string="Nhóm máu" context="{'group_by':'blood_type'}"/>
                        <filter name="group_marital_status" string="Tình trạng hôn nhân"
                                context="{'group_by':'marital_status'}"/>
                        <filter name="group_service_room" string="Phòng khám" context="{'group_by':'service_room'}"/>
                        <filter name="group_date" string="Ngày đến khám" context="{'group_by':'date:day'}"/>
                        <filter name="group_state" string="Trạng thái phiếu khám" context="{'group_by':'state'}"/>
                        <filter name="group_institution" string="Cơ sở ý tế" context="{'group_by':'institution'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Form Phiếu khám -->
        <record id="form_phieu_kham" model="ir.ui.view">
            <field name="name">Phiếu khám</field>
            <field name="model">sh.medical.appointment.register.walkin</field>
            <field name="type">form</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <form string="Phiếu khám" create="false" duplicate="false"
                      edit_expr="state in ['Scheduled','InProgress']">
                    <header>
                        <button confirm="Bạn có chắc muốn tạo một yêu cầu thu phí cho phiếu này?"
                                name="create_draft_payment" string="Yêu cầu thu phí"
                                attrs="{'invisible': ['|',('is_missing_money','=', False),('state','in',['Completed','Cancelled'])]}"
                                type="object" class="btn btn-danger"
                                groups="shealth_all_in_one.group_sh_medical_physician"/>
                        <!--                        <button confirm="Bạn có chắc muốn tạo một yêu cầu thu phí cho phiếu này?" name="create_draft_payment" string="Yêu cầu thu phí" attrs="{'invisible': ['|',('service','=',[]),('state','!=','Scheduled')]}" type="object" class="oe_highlight" groups="shealth_all_in_one.group_sh_medical_physician"/>-->
                        <button confirm="Bạn có chắc muốn đánh dấu phiếu này Đang thực hiện?" name="set_to_progress"
                                states="Payment" string="Đang thực hiện" type="object" class="oe_highlight"
                                groups="shealth_all_in_one.group_sh_medical_physician"/>
                        <button confirm="Bạn có chắc muốn đánh dấu phiếu này Đã Hoàn thành?" name="set_to_completed"
                                states="InProgress" string="Đã Hoàn thành" type="object" class="oe_highlight"
                                groups="shealth_all_in_one.group_sh_medical_physician"/>
                        <button confirm="Bạn có chắc muốn đặt lại phiếu này về Khám?" name="return_draft_status" states="WaitPayment" string="Đặt lại là Khám" type="object" class="btn-warning"/>
                        <button confirm="Bạn có chắc muốn đặt lại phiếu này về Khám?" name="return_draft_status_admin" states="Cancelled" string="Đặt lại là Khám (Admin)" type="object" class="btn-warning" groups="base.group_system"/>
                        <button confirm="Are you sure you want to mark walkin as Cancelled?" name="set_to_cancelled"
                                states="Scheduled,InProgress,WaitPayment,Payment" string="Đặt là hủy" type="object"
                                class=""
                                groups="shealth_all_in_one.group_sh_medical_stock_user,shealth_all_in_one.group_sh_medical_receptionist,shealth_all_in_one.group_sh_medical_manager"/>
                        <button name="add_evaluations"
                                type="object" states="Completed" class="btn-info"
                                context="{'default_institution': institution,'default_walkin': active_id,'default_patient':patient,'default_services':service,'default_admission_reason_walkin': reason_check}"
                                string="Tạo phiếu tái khám"/>
                        <button confirm="Bạn có chắc muốn đánh dấu phiếu này Đang thực hiện (Chỉ Admin)?"
                                name="set_to_progress_admin" states="Completed" string="Đặt lại là Đang thực hiện"
                                type="object" class="btn-warning" groups="shealth_all_in_one.group_sh_medical_manager"/>
                        <!--                        <button confirm="Are you sure you want to create the invoice?" name="action_walkin_invoice_create" states="Completed" string="Consultancy Invoice" type="object" class="oe_highlight" groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_manager"/>-->

                        <button name="print_service_info_sheet" string="In phiếu thông tin dịch vụ" type="object" class="btn-info"/>
                        <button name="print_report_hospital_discharge_sheet" states="Completed" string="In phiếu ra viện" type="object" class="btn-info"/>
                        <field name="state" widget="statusbar"
                               statusbar_visible="Scheduled,WaitPayment,InProgress,Completed,Cancelled"
                               statusbar_colors='{"Scheduled":"blue","InProgress":"red","Completed":"green","Cancelled":"grey"}'/>
                    </header>
                    <sheet>
                        <!-- smart button -->
                        <div name="button_box" class="oe_button_box">
                            <button name="view_walkin_material"
                                    states="InProgress,Completed"
                                    type="object"
                                    icon="fa-reorder"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_accountant">
                                <div class="o_stat_info">
<!--                                    <field name="lab_test_count"/>-->
                                    <span class="o_stat_text">Xem VTTH</span>
                                </div>
                            </button>
                            <button name="action_open_phieu_xet_nghiem"
                                    class="oe_stat_button"
                                    type="object"
                                    icon="fa-flask">
                                <div class="o_stat_info">
                                    <field name="lab_test_count"/>
                                    <span class="o_stat_text">Phiếu Xét nghiệm</span>
                                </div>
                            </button>
                            <button name="action_open_phieu_chan_doan_hinh_anh"
                                    class="oe_stat_button"
                                    type="object"
                                    attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment'])]}"
                                    icon="fa-picture-o">
                                <div class="o_stat_info">
                                    <field name="img_test_count"/>
                                    <span class="o_stat_text">Phiếu CĐHA - TDCN</span>
                                </div>
                            </button>
                            <button name="action_open_phieu_phau_thuat_thu_thuat"
                                    class="oe_stat_button"
                                    type="object"
                                    attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment'])]}"
                                    icon="fa-heart">
                                <div class="o_stat_info">
                                    <field name="surgery_count"/>
                                    <span class="o_stat_text">Phiếu Phẫu thuật - Thủ thuật</span>
                                </div>
                            </button>
                            <button name="action_open_phieu_chuyen_khoa"
                                    class="oe_stat_button"
                                    type="object"
                                    attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment'])]}"
                                    icon="fa-user-md">
                                <div class="o_stat_info">
                                    <field name="specialty_count"/>
                                    <span class="o_stat_text">Phiếu Chuyên khoa</span>
                                </div>
                            </button>
                            <button name="action_open_benh_nhan_luu"
                                    class="oe_stat_button"
                                    type="object"
                                    attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment'])]}"
                                    icon="fa-h-square">
                                <div class="o_stat_info">
                                    <field name="specialty_count"/>
                                    <span class="o_stat_text">Bệnh nhân lưu</span>
                                </div>
                            </button>
                            <button name="action_open_lich_tai_kham"
                                    class="oe_stat_button"
                                    type="object"
                                    attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment'])]}"
                                    icon="fa-calendar-check-o">
                                <div class="o_stat_info">
                                    <field name="reexam_count"/>
                                    <span class="o_stat_text">Hướng dẫn- Lịch chăm sóc</span>
                                </div>
                            </button>
<!--                            <button name="action_open_khao_sat"-->
<!--                                    class="oe_stat_button"-->
<!--                                    type="object"-->
<!--                                    icon="fa-smile-o">-->
<!--                                <div class="o_stat_info">-->
<!--                                    <field name="specialty_count"/>-->
<!--                                    <span class="o_stat_text">Khảo sát</span>-->
<!--                                </div>-->
<!--                            </button>-->
<!--                            <button name="action_open_phieu_xet_nghiem"-->
<!--                                    class="oe_stat_button"-->
<!--                                    type="object"-->
<!--                                    icon="fa-handshake-o"-->
<!--                                    groups="crm.group_use_lead"-->
<!--                                    attrs="{'invisible': ['|', '|', ('lead_type', '!=', 'lead'), ('state', '!=' , 'done')]}">-->
<!--                                <div class="o_stat_info">-->
<!--                                    <field name="lab_test_count"/>-->
<!--                                    <span class="o_stat_text">Phiếu xét nghiệm</span>-->
<!--                                </div>-->
<!--                            </button>-->
                        </div>
                        <h3>STT:
                            <span style="font-size:20px;">
                                <field name="index_by_day" class="text-danger oe_inline"/>
                            </span>
                        </h3>
                        <div class="oe_title oe_left">
                            <label class="oe_edit_only" for="name" string="Walkin #"/>
                            <h1>
                                <field name="name" class="oe_inline" force_save="1" readonly="1" widget="copy_char"/>
                            </h1>
                            <!--                            <h1><field name="name" class="oe_inline" force_save="1" attrs="{'readonly': [('state','in',['WaitPayment','Payment','InProgress','Completed'])]}"/></h1>-->
                            <div>
                                <label for="patient" class="oe_edit_only"/>
                                <field name="patient" class="text-uppercase" on_change="onchange_patient(patient)"
                                       force_save="1" readonly="1"/>
                            </div>
                            <div>
                                <label for="patient_level" class="oe_edit_only"/>
                                <field name="patient_level"/>
                            </div>
                            <div>
                                <field name="dob" placeholder="Ngày sinh..." force_save="1"/>
                                <field name="sex" placeholder="Giới tính..." class="ml-5" force_save="1"/>
                            </div>
                        </div>
                        <div class="oe_right">
                            <!--                            <div class="oe_title text-center border p-2 float-right">-->
                            <!--                                <label for="money_spent" string="Spent"/>-->
                            <!--                                <h3><span title="Done"><field name="money_spent" class="text-success"/></span></h3>-->
                            <!--                            </div>-->
                            <div class="oe_title text-center border p-2 float-right">
                                <label for="specialty_count" string="Chuyên khoa"/>
                                <h3>
                                    <!--                                    <span title="Done"><field name="specialty_done_count" class="text-success"/></span> /-->
                                    <span title="Total">
                                        <field name="specialty_count" class="text-primary" style="overflow: unset;"/>
                                    </span>
                                </h3>
                            </div>
                            <div class="oe_title text-center border p-2 float-right">
                                <label for="surgery_count" string="Phẫu thuật"/>
                                <h3>
                                    <!--                                    <span title="Done"><field name="surgery_done_count" class="text-success"/></span> /-->
                                    <span title="Total">
                                        <field name="surgery_count" class="text-primary" style="overflow: unset;"/>
                                    </span>
                                </h3>
                            </div>
                            <div class="oe_title text-center border p-2 float-right">
                                <label for="img_test_count" string="CĐHA - TDCN"/>
                                <h3>
                                    <span title="Done">
                                        <field name="img_test_done_count" class="text-success"
                                               style="overflow: unset;"/>
                                    </span>
                                    /
                                    <span title="Total">
                                        <field name="img_test_count" class="text-primary" style="overflow: unset;"/>
                                    </span>
                                </h3>
                            </div>
                            <div class="oe_title text-center border p-2 float-right">
                                <label for="lab_type_count" string="Xét nghiệm"/>
                                <h3>
                                    <span title="Done">
                                        <field name="lab_test_done_count" class="text-success"
                                               style="overflow: unset;"/>
                                    </span>
                                    /
                                    <span title="Total">
                                        <field name="lab_test_count" class="text-primary" style="overflow: unset;"/>
                                    </span>
                                </h3>
                            </div>
                        </div>
                        <group>
                            <group string="Thông tin chung">
<!--                                <field name="code_booking" options="{'no_create': True}" readonly="1" force_save="1"/>-->
                                <field name="booking_id" options="{'no_create': True}" readonly="1" force_save="1"/>
                                <!--                                <field name="sale_order_id" options="{'no_create': True,'no_open': True}" readonly="1" force_save="1"/>-->
                                <field name="reexam_count"/>
                                <field name="sale_order_id" invisible="1"/>
                                <field name="type_crm_id" force_save="1" readonly="1" options="{'no_open': True}"/>
                                <field name="root_walkin" options="{'no_create': True}"
                                       domain="[('patient','=',patient)]"
                                       attrs="{'required': [('type_crm_id','=',%(crm_base.type_oppor_guarantee)d)],'invisible': [('type_crm_id','!=',%(crm_base.type_oppor_guarantee)d)]}"/>

                                <field name="allow_institutions" invisible="1"/>
                                <field name="is_missing_money" invisible="1"/>
                                <field name="institution" domain="[('id', 'in', allow_institutions)]"
                                       options="{'no_create': True,'no_open': True}" readonly="1" force_save="1"/>
                                <field name="department" options="{'no_create': True}" invisible="1"/>
                                <!--                                <field name="department_current" options="{'no_create': True}" invisible="1"/>-->
                                <field name="related_department" options="{'no_create': True}" invisible="1"/>
                                <field name="service_room" attrs="{'readonly': [('state','not in',['Scheduled'])]}"
                                       string="Phòng khám" options="{'no_create': True,'no_open': True}" required="True"
                                       force_save="1"/>
                                <field name="room_type" invisible="1"/>
                                <field name="date"
                                       attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                       force_save="1"/>
                                <field name="service_date" attrs="{'readonly': [('state','=','Completed')]}" required="1"/>
                                <field name="service_date_start" readonly="True"/>
                                <field name="reason_check" required="True" force_save="1" string="Lý do vào viện"/>
                                <field name="doctor" required="0"
                                       domain="[('is_pharmacist', '=', False),('speciality', 'not in', [%(shealth_all_in_one.33)d,%(shealth_all_in_one.5)d]),('department','in', related_department)]"
                                       options="{'no_create': True,'no_open': True}"
                                       attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                       force_save="1"/>
                                <field name="reception_nurse" required="0"
                                       domain="[('is_pharmacist', '=', False),('speciality', 'in', [%(shealth_all_in_one.33)d,%(shealth_all_in_one.11)d,%(shealth_all_in_one.51)d,%(shealth_all_in_one.60)d]),('department','in', related_department)]"
                                       options="{'no_create': True,'no_open': True}"
                                       attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                       force_save="1"/>
<!--                                <field name="flag_surgery" groups="shealth_all_in_one.group_sh_medical_manager"/>-->
                                <!--                            </group>-->
                                <!--                            <group invisible="1">-->
                                <!--                                <field name="service_confirm" widget="many2many_tags" options="{'no_create': True}" invisible="1"/>-->
                                <!--&lt;!&ndash;                                <field name="service" widget="many2many_tags" options="{'no_create': True}" attrs="{'invisible': [('state','in',('Scheduled'))]}" domain="[('exam_room','=',service_room)]"/>&ndash;&gt;-->
                                <!--&lt;!&ndash;                                <field name="taskmaster" force_save="1"/>&ndash;&gt;-->
                                <!--                                <field name="user_approval" force_save="1" invisible="1"/>-->
                            </group>
                            <group>
                                <field name="pathological_process"
                                       attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                       force_save="1"/>
                                <field name="info_diagnosis" string="Chuẩn đoán vào viện"/>
                                <field name="note"/>
                                <field name="sale_order_id" options="{'no_create': True}" readonly="1" force_save="1"/>
                            </group>
                        </group>
                        <group>
<!--                            <div class="col-12 o_group_col_12 text-info show_normal_exam" style="cursor: pointer;"-->
<!--                                 title="Click vào để xem thông tin khám bệnh tổng quan"-->
<!--                                 onclick="(function(){$('.show_normal_exam i').toggle();$('.normal_exam').slideToggle();})()">-->
<!--                                <i class="fa fa-minus p-2" style="display:none;"></i>-->
<!--                                <i class="fa fa-plus p-2"></i>-->
<!--                                <b>XEM THÔNG TIN KHÁM TỔNG QUAN</b>-->
<!--                            </div>-->
<!--                            <group class="normal_exam col-12 o_group_col_12" style="display:none;">-->
<!--                                <group string="Tiền sử bệnh">-->
<!--                                    <field name="surgery_history"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="medical_history"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="allergy_history"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="family_history"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                </group>-->
<!--                                <group string="Khám bệnh">-->
<!--                                    <field name="physical_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="cyclic_info"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="respiratory_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="digest_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="reins_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="nerve_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="other_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="specialty_exam"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                </group>-->
<!--                                <group string="Các chỉ số">-->
<!--                                    <field name="temperature"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <label for="systolic" string="Huyết áp (mmHg)"/>-->
<!--                                    <div class="o_row">-->
<!--                                        <field name="systolic"-->
<!--                                               attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                               force_save="1"/>-->
<!--                                        <label for="diastolic" string="/"/>-->
<!--                                        <field name="diastolic"-->
<!--                                               attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                               force_save="1"/>-->
<!--                                    </div>-->
<!--                                    <field name="respiratory_rate"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="bpm"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->

<!--                                    <field name="weight" on_change="onchange_height_weight(height,weight)"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="height" on_change="onchange_height_weight(height,weight)"-->
<!--                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"-->
<!--                                           force_save="1"/>-->
<!--                                    <field name="bmi" readonly="1" force_save="1"/>-->
<!--                                </group>-->
<!--                                <group invisible="1">-->
<!--                                    <group>-->
<!--                                        <field name="marital_status" invisible="1"/>-->
<!--                                        <field name="rh" invisible="1"/>-->
<!--                                    </group>-->
<!--                                    <group>-->
<!--                                        <field name="blood_type" invisible="1"/>-->
<!--                                    </group>-->
<!--                                </group>-->
<!--                            </group>-->
                        </group>
                        <group>
                            <group string="Hướng xử trí">
                                <field name="pricelist_products" invisible="1"/>
                                <field name="service" widget="many2many_tags" options="{'no_create': True}"
                                       domain="[('exam_room','=',service_room), ('product_id', 'in', pricelist_products)]"
                                       attrs="{'readonly': [('state','in',['Completed'])]}"
                                       context="{'tree_view_ref': 'shealth_all_in_one.sh_medical_service_tree_simple'}"
                                       force_save="1"/>
                                <field name="uom_price" readonly="1" force_save="1" invisible="1"/>
<!--                                <field name="uom_price" attrs="{'invisible': [('room_type','not in',['Odontology'])]}"/>-->
                                <field name="teeths" readonly="1" force_save="1" attrs="{'invisible': [('room_type','not in',['Odontology'])]}" widget="many2many_tags" options="{'no_create': True}"/>
<!--                                <field name="session_num" readonly="1" force_save="1" attrs="{'invisible': [('room_type','not in',['Spa','Laser'])]}"/>-->
                                <field name="pathology" options="{'no_create': True,'no_open': True}"
                                       attrs="{'readonly': [('state','in',['Completed'])]}" force_save="1"/>
                            </group>
                        </group>
                        <div class="sh-box-control-print">
                            <field name="lab_test_done_count" invisible="1" force_save="1"/>
                            <field name="has_img_result" invisible="1" force_save="1"/>

                            <button name="print_assign_patient_labtest"
                                    attrs="{'invisible': [('lab_test_count','=',0)]}" string="CHỈ ĐỊNH XN" type="object"
                                    class="btn-info fa fa-print mr-5"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_physician_subclinical_labtest,shealth_all_in_one.group_sh_medical_manager"/>
                            <button name="print_result_patient_labtest"
                                    attrs="{'invisible': ['|',('lab_test_done_count','=',0),('lab_test_count','=',0)]}"
                                    string="KẾT QUẢ XN" type="object" class="btn-success fa fa-print mr-5"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_physician_subclinical_labtest,shealth_all_in_one.group_sh_medical_manager"/>

                            <button name="print_assign_patient_imaging"
                                    attrs="{'invisible': [('img_test_count','=',0)]}" string="CHỈ ĐỊNH CĐHA"
                                    type="object" class="btn-info fa fa-print mr-5"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_physician_subclinical_imaging,shealth_all_in_one.group_sh_medical_manager"/>
                            <button name="print_result_patient_imaging"
                                    attrs="{'invisible': ['|',('has_img_result','=',False),('img_test_count','=',0)]}"
                                    string="KẾT QUẢ CĐHA" type="object" class="btn-success fa fa-print mr-5"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_physician_subclinical_imaging,shealth_all_in_one.group_sh_medical_manager"/>

                            <button name="print_assign_patient_services"
                                    attrs="{'invisible': ['|',('service','=',[]),('state','not in',['InProgress','Completed'])]}"
                                    string="CHỈ ĐỊNH DỊCH VỤ" type="object" class="btn-info fa fa-print mr-5"
                                    groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_physician_subclinical_imaging,shealth_all_in_one.group_sh_medical_manager"/>
                        </div>
                        <notebook>
                            <page string="Thông tin khám tổng quan">
                            <group class="normal_exam col-12 o_group_col_12">
                                <group string="Tiền sử bệnh">
                                    <field name="surgery_history"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="medical_history"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="allergy_history"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="family_history"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                </group>
                                <group string="Khám bệnh">
                                    <field name="physical_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="cyclic_info"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="respiratory_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="digest_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="reins_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="nerve_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="other_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="specialty_exam"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                </group>
                                <group string="Các chỉ số">
                                    <field name="temperature"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <label for="systolic" string="Huyết áp (mmHg)"/>
                                    <div class="o_row">
                                        <field name="systolic"
                                               attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                               force_save="1"/>
                                        <label for="diastolic" string="/"/>
                                        <field name="diastolic"
                                               attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                               force_save="1"/>
                                    </div>
                                    <field name="respiratory_rate"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="bpm"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>

                                    <field name="weight" on_change="onchange_height_weight(height,weight)"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="height" on_change="onchange_height_weight(height,weight)"
                                           attrs="{'readonly': [('state','in',['WaitPayment','Payment','Completed'])]}"
                                           force_save="1"/>
                                    <field name="bmi" readonly="1" force_save="1"/>
                                </group>
                                <group invisible="1">
                                    <group>
                                        <field name="marital_status" invisible="1"/>
                                        <field name="rh" invisible="1"/>
                                    </group>
                                    <group>
                                        <field name="blood_type" invisible="1"/>
                                    </group>
                                </group>
                            </group>
                            </page>
                            <page string="Thông tin Tư vấn">
                                <div class="sh-box-control-print">
                                    <button name="print_assign_patient_services_advisory"
                                        attrs="{'invisible': [('list_advisory_services','=',[])]}"
                                        string="IN PHIẾU TƯ VẤN" type="object" class="btn-info fa fa-print"/>
                                </div>
                                <group string="Đã tư vấn">
                                    <group>
                                        <field name="level_of_improvement"/>
                                        <field name="service_costs"/>
                                        <field name="other_costs_incurred"/>
                                        <field name="hospital_checkout"/>
                                    </group>
                                    <group>
                                        <field name="warranty"/>
                                        <field name="therapy"/>
                                        <field name="diet"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="doctor_advice"/>
                                    <field name="conclude"/>
                                </group>
                                <group>
                                    <field name="list_advisory_services" domain="[('walkin', '=', active_id)]">
                                       <tree delete="false" create="false" string='Phiếu tư vấn dịch vụ' editable="bottom" class="tree_no_open">
                                            <field name="id" invisible="1"/>
                                            <field name="walkin" optional="hide" readonly="1" force_save="1"/>
                                            <field name="service_advisory" required="1" options="{'no_create': True,'no_open': True}" readonly="1" force_save="1"/>
                                            <field name="current_state" required="1"/>
                                            <field name="desire" required="1"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
<!--                            <page string="Phiếu xét nghiệm">-->
<!--                                <div class="sh-box-control-print pb-3">-->
<!--                                    <button name="reset_all_labtest" attrs="{'invisible':[('state','in',['Completed','Cancelled'])]}"-->
<!--                                            confirm="Bạn có chắc chắn muốn xóa toàn bộ loại Xét nghiệm đã kê bên dưới?"-->
<!--                                            string="Xóa tất cả Xét nghiệm" type="object"-->
<!--                                            class="btn-warning fa fa-trash mr-5"-->
<!--                                            groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_nurse"/>-->

<!--                                    <button name="add_config_labtest" attrs="{'invisible':['|',('state','in',['Completed','Cancelled']),('lab_test_ids','!=',[])]}"-->
<!--                                            confirm="Bạn có chắc chắn muốn thêm các loại Xét nghiệm đã cấu hình theo dịch vụ?"-->
<!--                                            string="Thêm các Xét nghiệm theo cấu hình Dịch vụ" type="object"-->
<!--                                            class="btn-info fa fa-plus mr-5"-->
<!--                                            groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_nurse"/>-->
<!--                                    &lt;!&ndash;                                    <button name="781" type="action" class="btn-info fa fa-plus oe_edit_only" context="{'default_notes':'Surgery','default_model_binding':'sh.medical.surgery.supply','default_room_use': operating_room}" string="Chọn nhiều Thuốc/vật tư"/>&ndash;&gt;-->
<!--                                </div>-->
<!--                                <field name="lab_test_ids"-->
<!--                                       context="{'default_walkin': active_id, 'default_requestor': doctor, 'default_patient': patient, 'default_sex': sex, 'default_dob': dob,'default_department': department,'default_institution': institution}"-->
<!--                                       domain="[('walkin', '=', active_id)]">-->
<!--                                    &lt;!&ndash;                                    <tree class="tree_no_open" delete="false" string='Lab Tests' decoration-info="state=='Draft'" decoration-success="state=='Completed'" decoration-danger="state=='Test In Progress'">&ndash;&gt;-->
<!--                                    <tree delete="false" string='Lab Tests' decoration-info="state=='Draft'"-->
<!--                                          decoration-success="state=='Completed'"-->
<!--                                          decoration-danger="state=='Test In Progress'"-->
<!--                                          editable="bottom" class="tree_no_open">-->
<!--&lt;!&ndash;                                        <field name="id" invisible="1"/>&ndash;&gt;-->
<!--                                        <field name="sequence" widget="handle"/>-->
<!--                                        <field name="name" optional="hide"/>-->
<!--                                        <field name="walkin" optional="hide" readonly="1" force_save="1"/>-->
<!--                                        <field name="patient" options="{'no_create': True,'no_open': True}" class="text-uppercase" readonly="1" force_save="1"/>-->
<!--                                        <field name="test_type" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="institution" options="{'no_create': True,'no_open': True}" required="1" domain="[('id', 'in', parent.allow_institutions)]" attrs="{'readonly': [('state','in',['Completed'])]}" force_save="1"/>-->
<!--                                        <field name="department" options="{'no_create': True,'no_open': True}" required="1" attrs="{'readonly': [('state','in',['Completed'])]}" force_save="1"/>-->
<!--                                        <field name="perform_room" options="{'no_create': True,'no_open': True}" required="1"/>-->
<!--                                        <field name="pathologist" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="requestor" options="{'no_create': True,'no_open': True}" optional="hide"/>-->
<!--                                        <field name="date_requested" required="1"/>-->
<!--                                        <field name="date_done"/>-->
<!--                                        <field name="doctor_note" optional="show"/>-->
<!--                                        <field name="state"/>-->
<!--&lt;!&ndash;                                        <field name="lab_test_material_ids" invisible="1"/>&ndash;&gt;-->
<!--&lt;!&ndash;                                        <field name="lab_test_criteria" invisible="1"/>&ndash;&gt;-->
<!--                                        <button name="view_detail_labtest" type="object" icon="fa-file-text-o" title="Chi tiết" style="font-size: 20px;"/>-->
<!--                                        <button confirm="Bạn có chắc chắn muốn xóa phiếu Xét nghiệm này?"-->
<!--                                                attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->
<!--                                        &lt;!&ndash;                                        <button name="action_confirm_and_print" string="Print" type="object"/>&ndash;&gt;-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
<!--                            <page string="Phiếu CĐHA - TDCN"-->
<!--                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}">-->
<!--                                <field name="imaging_ids"-->
<!--                                       context="{'default_walkin': active_id, 'default_requestor': doctor,-->
<!--                                       'default_patient': patient, 'default_sex': sex, 'default_dob': dob,-->
<!--                                       'default_department': department,'default_institution': institution}"-->
<!--                                       domain="[('walkin', '=', active_id)]">-->
<!--                                    <tree delete="false" string="Imaging Test"-->
<!--                                          decoration-info="state=='Draft'"-->
<!--                                          decoration-success="state=='Completed'"-->
<!--                                          decoration-danger="state=='Test In Progress'"-->
<!--                                          editable="bottom" class="tree_no_open">-->
<!--&lt;!&ndash;                                        <field name="id" invisible="1"/>&ndash;&gt;-->
<!--                                        <field name="name" optional="hide"/>-->
<!--&lt;!&ndash;                                        <field name="walkin" optional="hide" readonly="1" force_save="1"/>&ndash;&gt;-->
<!--&lt;!&ndash;                                        <field name="patient" options="{'no_create': True,'no_open': True}" class="text-uppercase" readonly="1" force_save="1"/>&ndash;&gt;-->
<!--                                        <field name="test_type" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="institution" options="{'no_create': True,'no_open': True}" required="1" domain="[('id', 'in', parent.allow_institutions)]" attrs="{'readonly': [('state','in',['Completed'])]}" force_save="1"/>-->
<!--                                        <field name="department" options="{'no_create': True,'no_open': True}" required="1" attrs="{'readonly': [('state','in',['Completed'])]}" force_save="1"/>-->
<!--                                        <field name="perform_room" options="{'no_create': True,'no_open': True}" required="1"/>-->
<!--                                        <field name="pathologist" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="requestor" options="{'no_create': True,'no_open': True}" optional="hide"/>-->
<!--                                        <field name="date_requested"/>-->
<!--                                        <field name="date_done"/>-->
<!--                                        <field name="doctor_note" optional="show"/>-->
<!--                                        <field name="state"/>-->
<!--&lt;!&ndash;                                        <field name="imaging_material_ids" invisible="1"/>&ndash;&gt;-->
<!--                                        <button name="view_detail_imaging" type="object" icon="fa-file-text-o" title="Chi tiết" style="font-size: 20px;"/>-->
<!--                                        <button confirm="Bạn có chắc chắn muốn xóa phiếu CĐHA - TDCN này?"-->
<!--                                                attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
<!--                            <page string="Surgeries"-->
<!--                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}"-->
<!--                                  groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_nurse">-->
<!--                                <field name="doctor_surgeon" invisible="1"/>-->
<!--                                <field name="doctor_anesthetist" invisible="1"/>-->
<!--                                <field name="surgeries_ids"-->
<!--                                       context="{'default_is_new_request': True, 'default_walkin': active_id, 'default_pathology': pathology, 'default_patient': patient, 'default_sex': sex, 'default_dob': dob,'default_institution': institution}"-->
<!--                                       domain="[('walkin', '=', active_id)]">-->
<!--                                    &lt;!&ndash;                                    <tree class="tree_no_open" delete="false" create="0" string="Surgeries" decoration-bf="state=='Signed'" decoration-it="state=='Confirmed'" decoration-info="state=='Draft'" decoration-success="state=='Done'" decoration-danger="state=='In Progress'">&ndash;&gt;-->
<!--                                    &lt;!&ndash;                                    <tree delete="false" create="0" string="Surgeries" decoration-bf="state=='Signed'" decoration-it="state=='Confirmed'" decoration-info="state=='Draft'" decoration-success="state=='Done'" decoration-danger="state=='In Progress'">&ndash;&gt;-->
<!--                                    <tree delete="false" string="Surgeries" decoration-bf="state=='Signed'"-->
<!--                                          decoration-it="state=='Confirmed'" decoration-info="state=='Draft'"-->
<!--                                          decoration-success="state=='Done'" decoration-danger="state=='In Progress'"-->
<!--                                          editable="bottom" class="tree_no_open">-->
<!--                                        <field name="is_new_request" invisible="1"/>-->
<!--                                        <field name="id" invisible="1"/>-->
<!--                                        <field name="name"/>-->
<!--                                        <field name="walkin" optional="hide" readonly="1" force_save="1"/>-->
<!--                                        &lt;!&ndash;                                        <field name="description"/>&ndash;&gt;-->
<!--                                        <field name="patient" class="text-uppercase" readonly="1" force_save="1"/>-->
<!--                                        <field name="services" options="{'no_create': True,'no_open': True}" required="1" widget="many2many_tags" attrs="{'readonly': [('state','in',['Done','Signed'])]}" domain="[('id', 'in', parent.service)]" force_save="1"/>-->
<!--                                        <field name="surgery_date"/>-->
<!--                                        <field name="pathology" options="{'no_create': True,'no_open': True}" optional="hide"/>-->
<!--                                        <field name="institution" options="{'no_create': True,'no_open': True}" required="1" domain="[('id', 'in', parent.allow_institutions)]" attrs="{'readonly': [('id','!=',False)]}" force_save="1"/>-->
<!--                                        <field name="department" options="{'no_create': True,'no_open': True}" required="1"/>-->
<!--                                        <field name="operating_room" options="{'no_create': True,'no_open': True}" required="1" domain="[('department','=',department),('state','=','Free'),('is_operating_theater','=',True)]"/>-->
<!--                                        <field name="surgeon" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="anesthetist" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="state"/>-->
<!--                                        <button name="view_detail_surgery" groups="shealth_all_in_one.group_sh_medical_physician_surgery" type="object" icon="fa-file-text-o" title="Chi tiết" style="font-size: 20px;"/>-->
<!--                                        <button confirm="Bạn có chắc chắn muốn xóa phiếu PTTT này?"-->
<!--                                                attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->
<!--                                        &lt;!&ndash;                                        <button name="action_confirm_and_print" string="Print" type="object"/>&ndash;&gt;-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
<!--                            <page string="Specialty"-->
<!--                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}"-->
<!--                                  groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_nurse">-->
<!--                                <field name="specialty_ids"-->
<!--                                       context="{'default_is_new_request': True, 'default_walkin': active_id,'default_pathology': pathology, 'default_patient': patient, 'default_sex': sex, 'default_dob': dob,'default_institution': institution}"-->
<!--                                       domain="[('walkin', '=', active_id)]">-->
<!--                                    &lt;!&ndash;                                    <tree class="tree_no_open" delete="false" create="0" string="Specialty" decoration-bf="state=='Signed'" decoration-it="state=='Confirmed'" decoration-info="state=='Draft'" decoration-success="state=='Done'" decoration-danger="state=='In Progress'">&ndash;&gt;-->
<!--                                    <tree delete="false" string="Specialty" decoration-bf="state=='Signed'"-->
<!--                                          decoration-it="state=='Confirmed'" decoration-info="state=='Draft'"-->
<!--                                          decoration-success="state=='Done'" decoration-danger="state=='In Progress'"-->
<!--                                          editable="bottom" class="tree_no_open">-->
<!--                                        &lt;!&ndash;                                    <tree string="Specialty" decoration-bf="state=='Signed'" decoration-it="state=='Confirmed'" decoration-info="state=='Draft'" decoration-success="state=='Done'" decoration-danger="state=='In Progress'">&ndash;&gt;-->
<!--                                        <field name="is_new_request" invisible="1"/>-->
<!--                                        <field name="id" invisible="1"/>-->
<!--                                        <field name="name"/>-->
<!--                                        <field name="walkin" optional="hide" readonly="1" force_save="1"/>-->
<!--                                        <field name="patient" class="text-uppercase" readonly="1" force_save="1" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="services" options="{'no_create': True,'no_open': True}" required="1" widget="many2many_tags" attrs="{'readonly': [('state','in',['Done'])]}" domain="[('id', 'in', parent.service)]" force_save="1"/>-->
<!--                                        <field name="pathology" options="{'no_create': True,'no_open': True}" optional="hide"/>-->
<!--                                        <field name="services_date"/>-->
<!--                                        <field name="institution" options="{'no_create': True,'no_open': True}" required="1" domain="[('id', 'in', parent.allow_institutions)]"/>-->
<!--                                        <field name="department" options="{'no_create': True,'no_open': True}" required="1" attrs="{'readonly': [('id','!=',False)]}" force_save="1"/>-->
<!--                                        <field name="perform_room" options="{'no_create': True,'no_open': True}" required="1"/>-->
<!--                                        <field name="physician" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="state"/>-->
<!--                                        <field name="show_specialty" invisible="1"/>-->
<!--                                        <button name="view_detail_specialty" type="object" icon="fa-file-text-o" attrs="{'invisible': [('show_specialty','=',False)]}" title="Chi tiết" style="font-size: 20px;"/>-->
<!--                                        <button confirm="Bạn có chắc chắn muốn xóa phiếu Chuyên khoa này?"-->
<!--                                                attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->

<!--                                        &lt;!&ndash;                                        <button name="action_confirm_and_print" string="Print" type="object"/>&ndash;&gt;-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
<!--                            <page string="Inpatient Admissions"-->
<!--                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}"-->
<!--                                  groups="shealth_all_in_one.group_sh_medical_physician,shealth_all_in_one.group_sh_medical_nurse">-->
<!--                                <field name="inpatient_ids"-->
<!--                                       context="{'default_institution': institution,'default_walkin': active_id,'default_admission_reason':pathology,'default_admission_type':'Elective','default_patient':patient,'default_operating_physician':doctor_surgeon,'default_attending_physician':doctor_anesthetist}"-->
<!--                                       domain="[('walkin', '=', active_id)]">-->
<!--                                    &lt;!&ndash;                                    <tree class="sh_has_icon tree_no_open" delete="false" string='Inpatient Admission' decoration-muted="state=='Invoiced'" decoration-info="state=='Hospitalized'" decoration-success="state=='Discharged'" decoration-danger="state=='Cancelled'">&ndash;&gt;-->
<!--                                    <tree class="sh_has_icon tree_no_open" delete="false" string='Inpatient Admission'-->
<!--                                          decoration-info="state=='Draft'" decoration-danger="state=='Hospitalized'"-->
<!--                                          decoration-success="state=='Discharged'"-->
<!--                                          decoration-muted="state=='Cancelled'"-->
<!--                                          editable="bottom">-->
<!--                                        <field name="walkin" optional="hide" readonly="1" force_save="1"/>-->
<!--                                        <field name="id" invisible="1"/>-->
<!--                                        <field name="name"/>-->
<!--                                        <field name="patient" class="text-uppercase" readonly="1" force_save="1"/>-->
<!--                                        <field name="admission_type" invisible="1"/>-->
<!--                                        <field name="institution" required="1" domain="[('id', 'in', parent.allow_institutions)]" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="ward" required="1" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field string="Phòng" name="room" required="1" options="{'no_create': True,'no_open':True}" attrs="{'readonly':[('state','!=','Draft')]}"/>-->
<!--                                        <field name="bed" options="{'no_create': True,'no_open': True}" domain="[('state','=','Free'),('room','=',room)]"/>-->
<!--                                        <field name="services" options="{'no_create': True,'no_open': True}" required="1" widget="many2many_tags" attrs="{'readonly': [('state','in',['Invoiced','Discharged','Cancelled'])]}" domain="[('id', 'in', parent.service)]" force_save="1"/>-->
<!--                                        <field name="admission_date" required="1"/>-->
<!--                                        <field name="discharge_date"/>-->
<!--                                        <field name="state" readonly="1" force_save="1"/>-->
<!--                                        <button name="view_detail_inpatient" groups="shealth_all_in_one.group_sh_medical_physician_surgery" type="object" icon="fa-file-text-o"-->
<!--                                                title="Chi tiết"/>-->
<!--                                        <button attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
                            <page string="Treatment"
                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}">
                                <group>
                                    <group>
                                        <!--                                        <field name="symptoms_ids" widget="many2many_tags" attrs="{'readonly': [('state','=','Completed')]}"/>-->
                                        <field name="handle" string="Xử trí"
                                               attrs="{'required' :[('state','in',['Completed'])]}"/>
                                        <field name="comments" string="Lời dặn bác sĩ"/>
                                    </group>
                                    <group>
                                        <!--                                        <field name="diagnosis_ids" widget="many2many_tags" attrs="{'readonly': [('state','=','Completed')]}"/>-->
                                        <field name="date_out" attrs="{'readonly': [('state','=','Completed')]}"/>
                                        <field name="close_walkin" readonly="True"/>
<!--                                        <field name="date_re_exam" attrs="{'readonly': [('state','=','Completed')]}"/>-->
                                    </group>
                                </group>
                                <!--                                DON THUOC-->
                                <group string="Prescriptions">
                                    <field nolabel="1" name="prescription_ids" options="{'reload_on_button': true}"
                                           domain="[('walkin', '=', active_id)]"
                                           context="{'view_only_name': True,'default_institution': institution,'default_walkin': active_id, 'default_date': date, 'default_date_out': date, 'default_is_normal': True, 'default_patient': patient,'default_doctor': doctor}">
                                        <!--                                        <tree string="Prescriptions" class="sh_has_icon tree_no_open" delete="false" decoration-info="state=='Draft'" decoration-success="state=='Đã xuất thuốc'">-->
                                        <tree string="Prescriptions" class="sh_has_icon tree_no_open" delete="false"
                                              decoration-info="state=='Draft'"
                                              decoration-danger="state=='Sent to Pharmacy'"
                                              decoration-success="state=='Đã xuất thuốc'"
                                              editable="bottom">
                                            <field name="id" invisible="1"/>
                                            <field name="walkin" force_save="1" optional="hide" readonly="1"/>
                                            <field name="evaluation" force_save="1" optional="hide" readonly="1"/>
                                            <field name="name" force_save="1"/>
                                            <field name="date"/>
                                            <field name="date_out" optional="hide" readonly="1" force_save="1"/>
                                            <field name="patient" class="text-uppercase" optional="hide" readonly="1" force_save="1"/>
                                            <field name="services" options="{'no_create': True,'no_open': True}" widget="many2many_tags" attrs="{'readonly': [('state','in',['Send to Pharmacy','Đã xuất thuốc'])]}" domain="[('id', 'in', parent.service)]" force_save="1"/>
                                            <field name="doctor" options="{'no_create': True,'no_open': True}"/>
                                            <field name="pharmacy" invisible="1"/>
                                            <field name="institution" domain="[('id', 'in', parent.allow_institutions)]" options="{'no_create': True,'no_open': True}"/>
                                            <field name="room_request" optional="show" required="1" options="{'no_create': True,'no_open': True}" attrs="{'readonly': [('state','!=','Draft')]}"/>
                                            <field name="room_stock_out" options="{'no_create': True,'no_open': True}" attrs="{'readonly': [('state','!=','Draft')]}"/>
<!--                                            <field name="location_id" domain="[('usage', '=', 'internal')]"-->
<!--                                                   options="{'no_create': True,'no_open': True}"/>-->
                                            <field name="state"/>
                                            <button name="view_detail_prescriptions" type="object" icon="fa-file-text-o" title="Chi tiết"/>
                                            <button attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"
                                                    name="unlink" type="object" icon="fa-trash-o" title="Xóa"
                                                    style="font-size: 20px;color:#000;"/>
                                            <!--                                        <button name="action_confirm_and_print" string="Print" type="object"/>-->
                                        </tree>
                                    </field>
                                </group>
                            </page>
<!--                            <page string="Hướng dẫn - Lịch tái khám"-->
<!--                                  attrs="{'invisible': [('state','in',['Scheduled','WaitPayment','Payment','Scheduled'])]}">-->
<!--                                <field nolabel="1" name="reexam_ids"-->
<!--                                           domain="[('walkin', '=', active_id)]"-->
<!--                                           context="{'default_patient': patient,'default_walkin': active_id, 'default_date': service_date}">-->
<!--                                        &lt;!&ndash;                                        <tree string="Prescriptions" class="sh_has_icon tree_no_open" delete="false" decoration-info="state=='Draft'" decoration-success="state=='Đã xuất thuốc'">&ndash;&gt;-->
<!--                                    <tree string="Lịch chăm sóc" class="sh_has_icon tree_no_open" delete="false"-->
<!--                                          decoration-info="state=='Draft'"-->
<!--                                          decoration-success="state=='Confirmed'"-->
<!--                                          editable="bottom">-->
<!--                                        <field name="id" invisible="1"/>-->
<!--                                        <field name="name" readonly="1" force_save="1"/>-->
<!--                                        <field name="walkin" force_save="1" optional="hide" readonly="1"/>-->
<!--                                        <field name="company" required="True" options="{'no_create': True,'no_open': True}"/>-->
<!--                                        <field name="date" required="1" attrs="{'readonly': [('id','!=',False)]}" force_save="1"/>-->
<!--                                        <field name="date_out" required="1" attrs="{'readonly': [('id','!=',False)]}" force_save="1"/>-->
<!--                                        <field name="patient" class="text-uppercase" readonly="1" force_save="1"/>-->
<!--                                        <field name="services" required="1" options="{'no_create': True,'no_open': True}" widget="many2many_tags" attrs="{'readonly': [('id','!=',False)]}" domain="[('id', 'in', parent.service)]" force_save="1"/>-->
<!--                                        <field name="state"/>-->
<!--                                        <field name="end_service"/>-->
<!--                                        <button name="view_detail_reexam" type="object" icon="fa-file-text-o" title="Chi tiết"/>-->
<!--                                        <button attrs="{'invisible': ['|',('state','!=','Draft'),('id','=',False)]}" class="oe_edit_only"-->
<!--                                                name="unlink" type="object" icon="fa-trash-o" title="Xóa"-->
<!--                                                style="font-size: 20px;color:#000;"/>-->
<!--                                        &lt;!&ndash;                                        <button name="action_confirm_and_print" string="Print" type="object"/>&ndash;&gt;-->
<!--                                    </tree>-->
<!--                                </field>-->
<!--                            </page>-->
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="phieu_kham_tree" model="ir.ui.view">
            <field name="name">Phiếu khám</field>
            <field name="model">sh.medical.appointment.register.walkin</field>
            <field name="type">tree</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <tree create="0" duplicate="false" delete="false"
                      string="Phiếu khám"
                      decoration-info="state=='Scheduled'"
                      decoration-bf="state=='WaitPayment'"
                      decoration-it="state=='Payment'"
                      decoration-success="state=='Completed'"
                      decoration-danger="state=='InProgress'"
                      default_order="date desc">
                    <field name="patient_level"
                           widget="label_selection"
                           options="{'classes': {'1': 'success', '2': 'info', '3': 'warning', '4': 'danger'}}"/>
                    <field name="date" widget="date"/>
<!--                    <field name="index_by_day" optional="hide"/>-->
                    <field name="booking_id" optional="show"/>
                    <field name="name" optional="show"/>
                    <field name="patient" class="text-uppercase" optional="show"/>
                    <field name="dob" optional="hide"/>
                    <field name="sex" optional="show"/>
                    <field name="institution" optional="hide"/>
                    <field name="service_room" optional="show"/>
                    <field name="reason_check" optional="hide"/>
                    <field name="service" widget="many2many_tags" optional="show"/>
                    <field name="doctor" optional="hide"/>
                    <field name="state" optional="hide"/>
                    <field name="note" optional="hide"/>
                    <field name="write_uid" optional="hide"/>
                    <field name="write_date" optional="hide"/>
                    <field name="sale_order_id" optional="hide"/>
                </tree>
            </field>
        </record>

        <record id="sh_phieu_kham_action" model="ir.actions.act_window">
            <field name="name">Phiếu khám</field>
            <field name="res_model">sh.medical.appointment.register.walkin</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_date_filter': True}</field>
            <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('phieu_kham_tree')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('form_phieu_kham')})]"/>
            <field name="search_view_id" ref="view_phieu_kham_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">Chưa có phiếu khám</p>
                <p>Bạn có thể tìm kiếm phiếu khám với tiêu chí hoặc bộ lọc khác</p>
                <p><i class="fa fa-lightbulb-o" aria-hidden="true"></i>
                    Phiếu khám được tạo từ booking</p>
            </field>
        </record>

        <record id="sh_phieu_kham_action_server" model="ir.actions.server">
                <field name="name">Phiếu khám</field>
                <field name="model_id" ref="model_sh_medical_appointment_register_walkin"/>
                <field name="state">code</field>
                <field name="code">
                    action = model.action_view_phieu_kham()
                </field>
        </record>

        <menuitem name="Phiếu khám"
                  id="sh_phieu_kham_menu"
                  action="sh_phieu_kham_action_server"
                  parent="shealth_all_in_one.sh_medical_menu"
                  sequence="1000"/>
        <record id="sh_phieu_kham_menu" model="ir.ui.menu">
            <field name="web_icon_class">fa fa-stethoscope</field>

            <field name="groups_id" eval="[(6,0,[ref('shealth_all_in_one.group_sh_medical_receptionist'),
                                                 ref('shealth_all_in_one.group_sh_medical_physician'),
                                                 ref('shealth_all_in_one.group_sh_medical_nurse')])]"/>
        </record>
    </data>
</odoo>